#!/usr/bin/env node

/*!
 * import(s)
 */
var anyrun = require('../');
var fs = require('fs');
var path = require('path');
var format = require('util').format;
var debug = require('debug')('anyrun');
var program = require('commander');

/*!
 * function(s)
 */
var readAnyRunFile = function (program) {
  var file = path.resolve(program.file || __dirname + '/../anyrun.js');
  debug('anyrun file path', file);
  var anyrun_file;
  try {
    anyrun_file = require(file);
  } catch (e) {
    console.error('Not found anyrun.js');
  }
  return anyrun_file;
};


// parse argv

program
  .version(JSON.parse(fs.readFileSync(__dirname + '/../package.json', 'utf8')).version)
  .usage('[options] [action ...]')
  .option('-t, --tasks', 'list all tasks')
  .option('-f, --file <file>', 'a task file to load')
  .parse(process.argv);

// --task option

if (program.tasks) {
  var anyrun_file = readAnyRunFile(program);
  // TODO: check exist deploy !!
  var tasks = anyrun_file.tasks || [];
  Object.keys(tasks).forEach(function (name) {
    console.log(format('  %s:  %s', name, tasks[name].description));
  });
  process.exit(0);
}

if (!program.args.length) {
  program.help();
  process.exit(1);
}
